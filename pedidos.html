<!DOCTYPE HTML>
<html lang="en" manifest="cache.php">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<meta name="apple-mobile-web-app-capable" content="yes"/>
		<meta names="apple-mobile-web-app-status-bar-style" conttent = "black-translucent"/>

		<title> BarCalculate</title>			

		<link rel="stylesheet" type="text/css" href="css/estilo.css">	
		<link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.3.2.min.css">	
		<!-- <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap-theme.css">	 -->
		<!-- <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.css">	 -->

	</head>
	<body>

		<!-- Home -->
		<div data-role="page" id="page-pedidos">
			
			<div data-theme="a" data-role="header">		        
		        <h3>
		            BarCalculate
		        </h3>	

				<div data-role="navbar" data-iconpos="right">
		            <ul>
		                <li>
		                    <a href="pedidos.html" data-transition="fade" data-theme="" data-icon="" class="btn-pedidos">
		                        Pedidos
		                    </a>
		                </li>
		                <li>
		                    <a href="pratos.html" data-transition="fade" data-theme="" data-icon="">
		                        Pratos
		                    </a>
		                </li>
		            </ul>
		        </div>

	        	<ul id="lista-pedido" data-role="listview" data-divider-theme="c" data-inset="true">
		            <li data-role="list-divider" role="heading">
                		Pedidos
                	</li>                	
            		
		            <!-- <li data-theme="d">						
		            	<img class="cerveja" src="img/cerveja.jpg" alt="" width="50px" >
		               	<span class="block">Cerveja</span>
		               	<label class="block floatLeft margin_right">Valor:</label>
		               	<span for="" class="floatLeft price" >R$ 4,00</span>	
						<div class="clear"></div>
						<div class="float_right">	
			                <span class="span-bt ui-li-count margin_right3" data-role="controlgroup" data-type="horizontal">
			                	<a data-role="button" href="#page1" class="minus">-</a>
			                    <a data-role="button" href="#page1" class="plus">+</a>
			                </span>
			                <label data-name="cerveja" class="quantity" data-valor="4">0</label>
		                </div>	
		                
		            </li>		            

		            <li data-theme="d">

		            	<img src="img/refrigerante.jpg" alt="" width="50px" >
		               	<span class="block">Refrigerante</span>
		               	<label class="block floatLeft margin_right">Valor:</label>
						<span for="" class="price">R$ 3,00</span>
						<div class="clear"></div>

		                <div class="float_right">	
			                <span class="span-bt ui-li-count margin_right3" data-role="controlgroup" data-type="horizontal">
			                	<a data-role="button" href="#page1" class="minus">-</a>
			                    <a data-role="button" href="#page1" class="plus">+</a>
			                </span>
			                <label data-name="refrigerante" class="quantity" data-valor="3">0</label>
		                </div>
		                
		            </li>

					 <li data-theme="d">

		            	<img src="img/bolinho.jpg" alt="" width="50px" >
		               	<span class="block">Bolinho de Carne</span>
		               	<label class="block floatLeft margin_right">Valor:</label>
						<span for="" class="price">R$ 12,00</span>
						<div class="clear"></div>

		                <div class="float_right">	
			                <span class="span-bt ui-li-count margin_right3" data-role="controlgroup" data-type="horizontal">
			                	<a data-role="button" href="#page1" class="minus">-</a>
			                    <a data-role="button" href="#page1" class="plus">+</a>
			                </span>
			                <label data-name="bolinhoDeCarne" class="quantity" data-valor="12">0</label>
		                </div>
		                
		            </li>

		             <li data-theme="d">

		            	<img src="img/tulipa_de_frango.jpg" alt="" width="50px" >
		               	<span class="block">Tulipa de Frango</span>
		               	<label class="block floatLeft margin_right">Valor:</label>
						<span for="" class="price">R$ 15,00</span>
						<div class="clear"></div>

		                <div class="float_right">	
			                <span class="span-bt ui-li-count margin_right3" data-role="controlgroup" data-type="horizontal">
			                	<a data-role="button" href="#page1" class="minus">-</a>
			                    <a data-role="button" href="#page1" class="plus">+</a>
			                </span>
			                <label data-name="tulipaDeFrango" class="quantity" data-valor="15">0</label>
		                </div>
		                
		            </li> -->		            

		            
		        </ul>
		        <ul>
		        	<li data-role="list-divider" role="footer">
		            	<label for="">Quantidade de Pessoas:</label>
		            	<input type="text" id="qtd_pessoas" class="soNumeros" val="0"/>
                		<a data-role="button" href="#page1" id="bt_calcular">Calcular</a>
                		<label for="">Resultado:</label>
		            	<label type="text" id="resultado">
            		</li>
		        </ul>

	        </div>

		    <div data-role="content">				
				<!-- <a href="#">
					<img class="asterisco" src="img/tulipa_de_frango.jpg" alt="" width="50px" >
					<img class="texto" src="img/bolinho.jpg" alt="" width="50px" >
					    
				</a> -->
		    </div>

		</div>

		<script src="js/jquery-1.9.1.min.js"></script>
		<script src="js/jquery.mobile-1.3.2.min.js"></script>
		<script src="js/util/util.js"></script>
		<script src="js/model/Prato.js"></script>
		
		<script>
								

			jQuery(document).ready(function(){				

				jQuery( document ).on( "pagebeforeload", function( event, data ) {
					// data.options.data = id_geral;
 					// console.log("data 2", data);
 					data.deferred.resolve( data.absUrl, data.options, page );
				});				

				console.log("antes div");

				var div_lista_pedido = jQuery("#lista-pedido");

				var prato = new Prato();				

				var pratos = prato.lista_pratos();				

				jQuery.each(pratos, function(index, prato){
					// console.log("index:", index);
					// console.log("val:", prato);
					var html = '<li data-theme="c" data-corners="false" data-shadow="false" data-iconshadow="true"'+
									 'data-wrapperels="div" data-icon="arrow-r" data-iconpos="right"'+
									 'class="ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-last-child ui-btn-up-c">'+
									 '<div class="ui-btn-inner ui-li"><div class="ui-btn-text">'+
										'<a href="../barCalculate/edit.php?id='+ prato.id +'" data-transition="slide" class="ui-link-inherit">' + 
											prato.nome +' R$ '+ prato.preco + 
										'</a>'+ 
										'</div><span class="ui-icon ui-icon-arrow-r ui-icon-shadow">&nbsp;</span></div>' +
								'</li>'; 


					var html2 = '<li data-theme="d" class="ui-li ui-li-static ui-btn-up-d ui-li-has-count ui-li-has-thumb">'+
		               	'<span class="block">'+ prato.nome +'</span>'+
		               	'<label class="block floatLeft margin_right">Pre√ßo:</label>'+
		               	'<span for="" class="floatLeft price">R$ '+ prato.preco +'</span>'+	
						'<div class="clear"></div>'+
						'<div class="float_right">'+	
			                '<span class="span-bt ui-li-count margin_right3 ui-btn-up-c ui-btn-corner-all '+
			                'ui-corner-all ui-controlgroup ui-controlgroup-horizontal" data-role="controlgroup"'+ 
			                'data-type="horizontal" aria-disabled="false" data-disabled="false" data-shadow="false"' + 
			                'data-corners="true" data-exclude-invisible="true" data-mini="false" '+
			                'data-init-selector=":jqmData(role="controlgroup")">'+
			                '<div class="ui-controlgroup-controls">'+
			                	'<a data-role="button" href="#page1" class="minus ui-btn ui-btn-up-a ui-shadow '+
			                	'ui-btn-corner-all ui-first-child" data-corners="true" data-shadow="true"' +
			                	 'data-iconshadow="true" data-wrapperels="span" data-theme="a">'+
			                	 '<span class="ui-btn-inner"><span class="ui-btn-text">-</span></span></a>'+
			                    '<a data-role="button" href="#page1" class="plus ui-btn ui-shadow ui-btn-corner-all '+ 
			                    'ui-last-child ui-btn-up-a" data-corners="true" data-shadow="true" '+
			                    'data-iconshadow="true" data-wrapperels="span" data-theme="a">'+
			                    '<span class="ui-btn-inner"><span class="ui-btn-text">+</span></span></a>'+
			                '</div></span>'+
			                '<label data-name="cerveja" class="quantity" data-valor="'+ prato.preco +'">0</label>'+
		                '</div>	'+		                
		            '</li>';
					

		            div_lista_pedido.append(html2);
					
				});

				jQuery(".soNumeros").keypress(function() {
                    soNumeros(event);
                });	

                jQuery("#bt_calcular").on("click", function(){
					var qtd_pessoas = parseInt(jQuery("#qtd_pessoas").val());
					var valor_total = 0.0;

					jQuery(".quantity").each(function(i, value){
						var qtd   = parseInt(jQuery(this).text());
						var price = parseFloat(jQuery(this).data('valor'));

						valor_total += (qtd * price); 					
						
					});

					valor_total = (valor_total/qtd_pessoas).toFixed(2);				

					jQuery("#resultado").text("R$ "+valor_total);				

				});

				jQuery(".minus").on("click", function(){								
					plusOrMinus(jQuery(this), "-");				
				});
				jQuery(".plus").on("click", function(){								
					plusOrMinus(jQuery(this), "+");				
				});
				
			});
												

			function plusOrMinus(div, plusOrMinus) {
				var label 	   = div.parent().parent().siblings(".quantity");				
				var value 	   = parseInt(label.text());
				if (plusOrMinus == "-") {
					if (value > 0) {
						value -= 1;	
					}
				} else {
					value += 1;
				}
				
				label.text(value);				
			}

			function soNumeros(evt) {
			    var theEvent = evt || window.event;
			    var key = ( theEvent.which ) ? theEvent.which : theEvent.keyCode
			    key = String.fromCharCode( key );
			    var regex = /[0-9]/;
			    if ([evt.keyCode||evt.which]==8 || [evt.keyCode||evt.which]== 9 || [evt.keyCode||evt.which]== 13) //this is to allow backspace (8), tab(9), enter(13)
			        return true;
			    if( !regex.test(key) ) {
			        theEvent.returnValue = false;
			        theEvent.preventDefault();
			    }
			}

		</script>

	</body>
</html>
