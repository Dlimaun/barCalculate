<!DOCTYPE HTML>
<html lang="en">	
    <body>

        <div class="btn-new ">
            <label for="qtd_pessoas" class="slide">Quantidade de Pessoas</label>
            <input type="text" id="qtd_pessoas" class="form-control" value="0">
            
            <div class="clear"></div>
            
            <label for="resultado" class="margin_top">Divis√£o</label>            
            <h4><label id="resultado" class="margin_top label label-success">R$ 0,00</label></h4>
            
        </div>

        <div class="list-group">
<!--            <a href="javascript:void(0)" class="list-group-item">
                <span class="badge">
                    <button type="button" class="btn btn-danger minus">-</button>
                    <span class="badge">10</span>                     
                    <button type="button" class="btn btn-success plus">+</button>
                </span>

                <h4 class="list-group-item-heading">Fanta</h4>
                <p class="list-group-item-text">R$ 1,00</p>
            </a>-->
        </div>

        <script>
								

            jQuery(document).ready(function(){

                var div_lista_pedido = jQuery(".list-group");

                var prato = new Prato();				

                var pratos = prato.lista_pratos();				

                jQuery.each(pratos, function(index, prato){
                    // console.log("index:", index);
                    // console.log("val:", prato);

                    var html = '<a href="javascript:void(0)" class="list-group-item">'+
                        '<span class="badge">'+
                        '<button type="button" class="btn btn-danger minus">-</button>'+
                        '<span class="badge quantity" data-valor="'+ prato.preco +'">0</span>'+
                        '<button type="button" class="btn btn-success plus">+</button>'+
                        '</span>'+
                        '<h4 class="list-group-item-heading">'+ prato.nome +'</h4>'+
                        '<p class="list-group-item-text">'+ prato.preco +'</p>'+
                        '</a>';    

                    div_lista_pedido.append(html);
					
                });

                jQuery(".soNumeros").keypress(function() {
                    soNumeros(event);
                });	                

                jQuery('#qtd_pessoas').on('keyup', calcula_pedidos);

                jQuery(".minus").on("click", function(){
                    var quantity = jQuery(this).next();                    
                    var value 	 = parseInt(quantity.text());
                    var result   = plusOrMinus(value, "-");
                    
                    quantity.text(result);
                    calcula_pedidos();
                });
                jQuery(".plus").on("click", function(){
                    var quantity = jQuery(this).prev();
                    var value 	 = parseInt(quantity.text());
                    var result   = plusOrMinus(value, "+");
                    
                    quantity.text(result);
                    calcula_pedidos();
                });
				
            });
												

            function plusOrMinus(value, plusOrMinus) {                
                if (plusOrMinus == "-") {
                    if (value > 0) {
                        value -= 1;	
                    }
                } else {
                    value += 1;
                }
		
                return value;
            }        
            
            function calcula_pedidos(){
                    var qtd_pessoas = jQuery("#qtd_pessoas").val();
                    var valor_total = 0.0;
                    
                    if (qtd_pessoas == '' || qtd_pessoas == 0) {
                        jQuery("#resultado").text("R$ 0,00");
                        return false;
                    } else {
                        qtd_pessoas = parseInt(qtd_pessoas);
                    }
                    
                    jQuery(".quantity").each(function(i, value){
                        var qtd   = parseInt(jQuery(this).text());
                        var price = jQuery(this).data('valor');
                        
                        price = price.replace("R$", "").replace(".", "").replace(",", ".");
                        var price_formatado = parseFloat(price);

                        valor_total += (qtd * price); 					
						
                    });

                    valor_total = (valor_total/qtd_pessoas).toFixed(2);				

                    jQuery("#resultado").text("R$ "+valor_total);

             }

        </script>

    </body>
</html>
